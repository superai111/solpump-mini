<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solpump Mini</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#050814;
  color:#fff;
}
.container{
  max-width:420px;
  margin:auto;
  padding:16px;
}
.card{
  background:#0b1535;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
.multiplier{
  font-size:56px;
  text-align:center;
  font-weight:bold;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#22f3a6;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{
  background:#2c3e50;
}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:8px;
  font-size:16px;
}
.warn{
  color:#ff6b6b;
  margin-top:8px;
}
.history{
  display:flex;
  gap:8px;
  overflow-x:auto;
}
.history span{
  padding:6px 10px;
  border-radius:10px;
  background:#1c7a52;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
  <h2>üöÄ Solpump Mini</h2>
  <div>Points: <b id="pointsText">0</b></div>
</div>

<div class="card">
  <div class="history" id="history"></div>
</div>

<div class="card">
  <div class="multiplier" id="multiplier">1.00x</div>
</div>

<div class="card">
  <input id="betInput" type="number" placeholder="Bet points">
  <input id="autoInput" type="number" placeholder="Auto cashout (x)">
  <div class="warn" id="warn"></div>
  <button id="startBtn">START</button>
  <button id="stopBtn" disabled style="margin-top:8px">STOP</button>
</div>

<div class="card">
  <input id="buyInput" type="number" placeholder="Buy points">
  <button id="buyBtn">ADD POINTS</button>
</div>

</div>

<script>
/* =========================
   PERSISTENT STATE
========================= */
let points = Number(localStorage.getItem("points") || 1000);

/* =========================
   ROUND STATE
========================= */
let roundActive = false;
let playerExited = false;

let betPoints = 0;
let autoCashout = null;

let liveMultiplier = 1.0;
let crashPoint = 0;
let intervalId = null;

/* =========================
   UI ELEMENTS
========================= */
const pointsText = document.getElementById("pointsText");
const multiplierEl = document.getElementById("multiplier");
const historyEl = document.getElementById("history");
const warnEl = document.getElementById("warn");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");

/* =========================
   INIT
========================= */
updatePointsUI();

/* =========================
   HELPERS
========================= */
function updatePointsUI(){
  pointsText.textContent = points;
  localStorage.setItem("points", points);
}

function generateCrashPoint(){
  const r = Math.random();
  if(r < 0.6) return 1 + Math.random() * 1.2;
  if(r < 0.85) return 2.2 + Math.random() * 2;
  return 4 + Math.random() * 6;
}

/* =========================
   ROUND CONTROL
========================= */
startBtn.onclick = () => {
  if(roundActive) return;

  betPoints = Number(betInput.value);
  autoCashout = Number(autoInput.value) || null;

  if(!betPoints || betPoints <= 0){
    warnEl.textContent = "Vui l√≤ng nh·∫≠p s·ªë point c∆∞·ª£c";
    return;
  }

  if(betPoints > points){
    warnEl.textContent = "‚ùó S·ªë point kh√¥ng ƒë·ªß, b·∫°n c·∫ßn n·∫°p th√™m";
    return;
  }

  warnEl.textContent = "";

  // deduct points immediately
  points -= betPoints;
  updatePointsUI();

  // init round
  liveMultiplier = 1.0;
  crashPoint = generateCrashPoint();
  roundActive = true;
  playerExited = false;

  multiplierEl.textContent = "1.00x";
  startBtn.disabled = true;
  stopBtn.disabled = false;

  intervalId = setInterval(runRound, 16);
};

function runRound(){
  if(!roundActive) return;

  // SPEED ƒê·ªÄU ‚Äì NHANH (KH√îNG TƒÇNG T·ªêC)
  liveMultiplier += 0.03;

  // fake lag nh·∫π
  if(Math.random() < 0.05) return;

  multiplierEl.textContent = liveMultiplier.toFixed(2) + "x";

  // auto cashout
  if(!playerExited && autoCashout && liveMultiplier >= autoCashout){
    cashout();
  }

  // crash check
  if(liveMultiplier >= crashPoint){
    endRound();
  }
}

function cashout(){
  if(playerExited || !roundActive) return;
  playerExited = true;

  const win = Math.floor(betPoints * liveMultiplier);
  points += win;
  updatePointsUI();
}

function endRound(){
  roundActive = false;
  clearInterval(intervalId);

  multiplierEl.textContent = crashPoint.toFixed(2) + "x";

  const span = document.createElement("span");
  span.textContent = crashPoint.toFixed(2) + "x";
  historyEl.prepend(span);

  startBtn.disabled = false;
  stopBtn.disabled = true;
}

/* =========================
   UI ACTIONS
========================= */
stopBtn.onclick = cashout;

buyBtn.onclick = () => {
  const add = Number(buyInput.value);
  if(!add || add <= 0) return;
  points += add;
  updatePointsUI();
};
</script>

</body>
</html>
